<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">
<meta name="google-site-verification" content="8UOZuQDq-BH1tVPdDgSiPq7FkqJB3-3wRwcvzozjmac">
<meta name="baidu-site-verification" content="oN4T9YsHyS">
<meta name="referrer" content="no-referrer">








<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Android,">





  <link rel="alternate" href="/atom.xml" title="美丽新世界" type="application/atom+xml">






<meta name="description" content="一提到沉浸式状态栏，第一个浮现在脑海里的词就是“碎片化”。碎片化是让 Android 开发者很头疼的问题，相信没有哪位开发者会不喜欢“write once, run anywhere”的感觉，碎片化让我们不得不耗费精力去校验代码在各个系统版本、各个机型上是否有效。因此以前我一直把沉浸式状态栏看作一块难啃的骨头，但是该面对的问题迟早还是要面对，所以，不如就此开始吧。 沉浸式状态栏的实现方法一：通过">
<meta name="keywords" content="Android">
<meta property="og:type" content="article">
<meta property="og:title" content="Android 沉浸式状态栏的实现">
<meta property="og:url" content="https://yazhidev.github.io/2017/08/22/Android-沉浸式状态栏的实现/index.html">
<meta property="og:site_name" content="美丽新世界">
<meta property="og:description" content="一提到沉浸式状态栏，第一个浮现在脑海里的词就是“碎片化”。碎片化是让 Android 开发者很头疼的问题，相信没有哪位开发者会不喜欢“write once, run anywhere”的感觉，碎片化让我们不得不耗费精力去校验代码在各个系统版本、各个机型上是否有效。因此以前我一直把沉浸式状态栏看作一块难啃的骨头，但是该面对的问题迟早还是要面对，所以，不如就此开始吧。 沉浸式状态栏的实现方法一：通过">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1929170-c08abb9ba6f70b74.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1929170-63917634d1d9907c.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1929170-58345fb239443476.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1929170-34df51c894b9dcd6.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1929170-16d1ccdfa6a2ba3f.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1929170-fe91c2788698c4ab.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1929170-6d63da87454965c6.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1929170-4730752cae8d63da.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1929170-6035298aaa147e24.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:updated_time" content="2022-06-07T22:58:54.435Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android 沉浸式状态栏的实现">
<meta name="twitter:description" content="一提到沉浸式状态栏，第一个浮现在脑海里的词就是“碎片化”。碎片化是让 Android 开发者很头疼的问题，相信没有哪位开发者会不喜欢“write once, run anywhere”的感觉，碎片化让我们不得不耗费精力去校验代码在各个系统版本、各个机型上是否有效。因此以前我一直把沉浸式状态栏看作一块难啃的骨头，但是该面对的问题迟早还是要面对，所以，不如就此开始吧。 沉浸式状态栏的实现方法一：通过">
<meta name="twitter:image" content="http://upload-images.jianshu.io/upload_images/1929170-c08abb9ba6f70b74.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://yazhidev.github.io/2017/08/22/Android-沉浸式状态栏的实现/">





  <title>Android 沉浸式状态栏的实现 | 美丽新世界</title>
  




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-125080992-2', 'auto');
  ga('send', 'pageview');
</script>


  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?638091a8d8717585b52d0e3ef0b65002";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">美丽新世界</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://yazhidev.github.io/2017/08/22/Android-沉浸式状态栏的实现/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Taki">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/link.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="美丽新世界">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Android 沉浸式状态栏的实现</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-22T19:26:44+08:00">
                2017-08-22
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>一提到沉浸式状态栏，第一个浮现在脑海里的词就是“碎片化”。碎片化是让 Android 开发者很头疼的问题，相信没有哪位开发者会不喜欢“write once, run anywhere”的感觉，碎片化让我们不得不耗费精力去校验代码在各个系统版本、各个机型上是否有效。因此以前我一直把沉浸式状态栏看作一块难啃的骨头，但是该面对的问题迟早还是要面对，所以，不如就此开始吧。</p>
<h1 id="沉浸式状态栏的实现"><a href="#沉浸式状态栏的实现" class="headerlink" title="沉浸式状态栏的实现"></a>沉浸式状态栏的实现</h1><h2 id="方法一：通过设置-Theme-主题设置状态栏透明"><a href="#方法一：通过设置-Theme-主题设置状态栏透明" class="headerlink" title="方法一：通过设置 Theme 主题设置状态栏透明"></a>方法一：通过设置 Theme 主题设置状态栏透明</h2><p>因为 API21 之后（也就是 android 5.0 之后）的状态栏，会默认覆盖一层半透明遮罩。且为了保持4.4以前系统正常使用，故需要三份 style 文件，即默认的values（不设置状态栏透明）、values-v19、values-v21（解决半透明遮罩问题）。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">//valuse</span><br><span class="line">&lt;style name=&quot;TranslucentTheme&quot; parent=&quot;AppTheme&quot;&gt;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br><span class="line">// values-v19。v19 开始有 android:windowTranslucentStatus 这个属性</span><br><span class="line">&lt;style name=&quot;TranslucentTheme&quot; parent=&quot;Theme.AppCompat.Light.NoActionBar&quot;&gt;</span><br><span class="line">        &lt;item name=&quot;android:windowTranslucentStatus&quot;&gt;true&lt;/item&gt;</span><br><span class="line">        &lt;item name=&quot;android:windowTranslucentNavigation&quot;&gt;true&lt;/item&gt;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br><span class="line">// values-v21。5.0 以上提供了 setStatusBarColor()  方法设置状态栏颜色。</span><br><span class="line">&lt;style name=&quot;TranslucentTheme&quot; parent=&quot;Theme.AppCompat.Light.NoActionBar&quot;&gt;</span><br><span class="line">    &lt;item name=&quot;android:windowTranslucentStatus&quot;&gt;false&lt;/item&gt;</span><br><span class="line">    &lt;item name=&quot;android:windowTranslucentNavigation&quot;&gt;true&lt;/item&gt;</span><br><span class="line">    &lt;!--Android 5.x开始需要把颜色设置透明，否则导航栏会呈现系统默认的浅灰色--&gt;</span><br><span class="line">    &lt;item name=&quot;android:statusBarColor&quot;&gt;@android:color/transparent&lt;/item&gt;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/1929170-c08abb9ba6f70b74.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="设置状态栏为透明"></p>
<p>由图可见，设置之后布局的内容延伸到了状态栏。但有些场景下，我们还是需要状态栏那块位置存在的（然而不存在的）。有三种解决方法：</p>
<h3 id="法一：设置-fitsSystemWindows-属性"><a href="#法一：设置-fitsSystemWindows-属性" class="headerlink" title="法一：设置 fitsSystemWindows 属性"></a>法一：设置 fitsSystemWindows 属性</h3><p>引用一下官方对该属性的解释吧：</p>
<blockquote>
<p>android:fitsSystemWindows</p>
<p>Boolean internal attribute to adjust view layout based on system windows such as the status bar. If true, adjusts the padding of this view to leave space for the system windows. Will only take effect if this view is in a non-embedded activity.</p>
</blockquote>
<p>当该属性设置 true 时，会在屏幕最上方预留出状态栏高度的 padding。</p>
<p>在布局的最外层设置 <code>android:fitsSystemWindows=&quot;true&quot;</code> 属性。当然，也可以通过代码设置：</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 设置页面最外层布局 FitsSystemWindows 属性</span><br><span class="line"> * @param activity</span><br><span class="line"> * @param value</span><br><span class="line"> */</span><br><span class="line">public static void setFitsSystemWindows(Activity activity, boolean value) &#123;</span><br><span class="line">    ViewGroup contentFrameLayout = (ViewGroup) activity.findViewById(android.R.id.content);</span><br><span class="line">    View parentView = contentFrameLayout.getChildAt(0);</span><br><span class="line">    if (parentView != null &amp;&amp; Build.VERSION.SDK_INT &gt;= 14) &#123;</span><br><span class="line">        parentView.setFitsSystemWindows(value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过该设置保留状态栏高度的 <code>paddingTop</code> 后，再设置状态栏的颜色。就可以达到设想的效果。但这种方式实现有些问题，例如我们想设置状态栏为蓝色，只能通过设置最外层布局的背景为蓝色来实现，然而一旦设置后，整个布局就都变成了蓝色，只能在下方的布局内容里另外再设置白色背景，而这样就存在过度绘制了。而且设置了 <code>fitsSystemWindows=true</code> 属性的页面，在点击 EditText 调出 软键盘时，整个视图都会被顶上去。</p>
<h3 id="法二：布局里添加占位状态栏"><a href="#法二：布局里添加占位状态栏" class="headerlink" title="法二：布局里添加占位状态栏"></a>法二：布局里添加占位状态栏</h3><p>法一：在根布局加入一个占位状态栏，这样虽然整个内容页面时顶到头的，但是因为在内容布局里添加了一个占位状态栏，所以效果与设想的一致。</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;View</span><br><span class="line">  android:id=&quot;@+id/statusBarView&quot;</span><br><span class="line">  android:background=&quot;@color/blue&quot;</span><br><span class="line">  android:layout_width=&quot;match_parent&quot;</span><br><span class="line">  android:layout_height=&quot;wrap_content&quot;&gt;&lt;/View&gt;</span><br></pre></td></tr></table></figure>
<p>  通过反射获取状态栏高度：</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 利用反射获取状态栏高度</span><br><span class="line"> * @return</span><br><span class="line"> */</span><br><span class="line">public int getStatusBarHeight() &#123;</span><br><span class="line">    int result = 0;</span><br><span class="line">    //获取状态栏高度的资源id</span><br><span class="line">    int resourceId = getResources().getIdentifier(&quot;status_bar_height&quot;, &quot;dimen&quot;, &quot;android&quot;);</span><br><span class="line">    if (resourceId &gt; 0) &#123;</span><br><span class="line">        result = getResources().getDimensionPixelSize(resourceId);</span><br><span class="line">    &#125;</span><br><span class="line">    return result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>  设置占位视图高度</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">View statusBar = findViewById(R.id.statusBarView);</span><br><span class="line">ViewGroup.LayoutParams layoutParams = statusBar.getLayoutParams();</span><br><span class="line">layoutParams.height = getStatusBarHeight();</span><br></pre></td></tr></table></figure>
<p>当然，除了从布局文件中添加这一方式之外，一样可以在代码中添加。比较推荐使用代码添加的方式，方便封装使用。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 添加状态栏占位视图</span><br><span class="line"> *</span><br><span class="line"> * @param activity</span><br><span class="line"> */</span><br><span class="line">private void addStatusViewWithColor(Activity activity, int color) &#123;</span><br><span class="line">    ViewGroup contentView = (ViewGroup) activity.findViewById(android.R.id.content);    </span><br><span class="line">    View statusBarView = new View(activity);</span><br><span class="line">    ViewGroup.LayoutParams lp = new ViewGroup.LayoutParams(ViewGroup.LayoutParams.MATCH_PARENT,</span><br><span class="line">            getStatusBarHeight(activity));</span><br><span class="line">    statusBarView.setBackgroundColor(color);</span><br><span class="line">    contentView.addView(statusBarView, lp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/1929170-63917634d1d9907c.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="添加占位状态栏"></p>
<h3 id="法三：代码中设置-paddingTop-并添加占位状态栏"><a href="#法三：代码中设置-paddingTop-并添加占位状态栏" class="headerlink" title="法三：代码中设置 paddingTop 并添加占位状态栏"></a>法三：代码中设置 paddingTop 并添加占位状态栏</h3><p>手动给根视图设置一个 <code>paddingTop</code> ，高度为状态栏高度，相当于手动实现了  <code>fitsSystemWindows=true</code> 的效果，然后再在根视图加入一个占位视图，其高度也设置为状态栏高度。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">//设置 paddingTop</span><br><span class="line">ViewGroup rootView = (ViewGroup) mActivity.getWindow().getDecorView().findViewById(android.R.id.content);</span><br><span class="line">rootView.setPadding(0, getStatusBarHeight(mActivity), 0, 0);</span><br><span class="line">if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP) &#123;</span><br><span class="line">    //5.0 以上直接设置状态栏颜色</span><br><span class="line">    activity.getWindow().setStatusBarColor(color);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    //根布局添加占位状态栏</span><br><span class="line">    ViewGroup decorView = (ViewGroup) mActivity.getWindow().getDecorView();</span><br><span class="line">    View statusBarView = new View(activity);</span><br><span class="line">    ViewGroup.LayoutParams lp = new ViewGroup.LayoutParams(ViewGroup.LayoutParams.MATCH_PARENT,</span><br><span class="line">            getStatusBarHeight(activity));</span><br><span class="line">    statusBarView.setBackgroundColor(color);</span><br><span class="line">    decorView.addView(statusBarView, lp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>个人认为最优解应该是第三种方法，通过这种方法达到沉浸式的效果后面也可以很方便地拓展出渐变色的状态栏。</p>
<h2 id="方法二：代码中设置"><a href="#方法二：代码中设置" class="headerlink" title="方法二：代码中设置"></a>方法二：代码中设置</h2><p>通过在代码中设置，实现方法一中在 Theme 主题样式里设置的属性，便于封装。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"> if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.KITKAT) &#123;</span><br><span class="line">    int flagTranslucentStatus = WindowManager.LayoutParams.FLAG_TRANSLUCENT_STATUS;</span><br><span class="line">    int flagTranslucentNavigation = WindowManager.LayoutParams.FLAG_TRANSLUCENT_NAVIGATION;</span><br><span class="line">    if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP) &#123;</span><br><span class="line">        Window window = getWindow();</span><br><span class="line">        WindowManager.LayoutParams attributes = window.getAttributes();</span><br><span class="line">        attributes.flags |= flagTranslucentNavigation;</span><br><span class="line">        window.setAttributes(attributes);</span><br><span class="line">        getWindow().setStatusBarColor(Color.TRANSPARENT);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        Window window = getWindow();</span><br><span class="line">        WindowManager.LayoutParams attributes = window.getAttributes();</span><br><span class="line">        attributes.flags |= flagTranslucentStatus | flagTranslucentNavigation;</span><br><span class="line">        window.setAttributes(attributes);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但是从图片中也看到了，该方案会导致一个问题就是导航栏颜色变灰。<br>经测试，在 5.x 以下导航栏透明是可以生效的，但 5.x 以上导航栏会变灰色（正常情况下我们期望导航栏保持默认颜色黑色不变），但因为设置了<code>FLAG_TRANSLUCENT_NAVIGATION</code>，所以即使代码中设置 <code>getWindow().setNavigationBarColor(Color.BLACK);</code> 也是不起作用的。但如果不设置该 FLAG ，状态栏又无法被置为隐藏和设置透明。</p>
<h1 id="方案二：全屏模式的延伸"><a href="#方案二：全屏模式的延伸" class="headerlink" title="方案二：全屏模式的延伸"></a>方案二：全屏模式的延伸</h1><p>通过设置 FLAG ，让应用内容占用系统状态栏的空间，经测试该方式不会影响对导航栏的设置。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 通过设置全屏，设置状态栏透明</span><br><span class="line"> *</span><br><span class="line"> * @param activity</span><br><span class="line"> */</span><br><span class="line">private void fullScreen(Activity activity) &#123;</span><br><span class="line">    if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.KITKAT) &#123;</span><br><span class="line">        if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP) &#123;</span><br><span class="line">            //5.x开始需要把颜色设置透明，否则导航栏会呈现系统默认的浅灰色</span><br><span class="line">            Window window = activity.getWindow();</span><br><span class="line">            View decorView = window.getDecorView();</span><br><span class="line">            //两个 flag 要结合使用，表示让应用的主体内容占用系统状态栏的空间</span><br><span class="line">            int option = View.SYSTEM_UI_FLAG_LAYOUT_FULLSCREEN</span><br><span class="line">                    | View.SYSTEM_UI_FLAG_LAYOUT_STABLE;</span><br><span class="line">            decorView.setSystemUiVisibility(option);</span><br><span class="line">            window.addFlags(WindowManager.LayoutParams.FLAG_DRAWS_SYSTEM_BAR_BACKGROUNDS);</span><br><span class="line">            window.setStatusBarColor(Color.TRANSPARENT);</span><br><span class="line">            //导航栏颜色也可以正常设置</span><br><span class="line">//                window.setNavigationBarColor(Color.TRANSPARENT);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            Window window = activity.getWindow();</span><br><span class="line">            WindowManager.LayoutParams attributes = window.getAttributes();</span><br><span class="line">            int flagTranslucentStatus = WindowManager.LayoutParams.FLAG_TRANSLUCENT_STATUS;</span><br><span class="line">            int flagTranslucentNavigation = WindowManager.LayoutParams.FLAG_TRANSLUCENT_NAVIGATION;</span><br><span class="line">            attributes.flags |= flagTranslucentStatus;</span><br><span class="line">//                attributes.flags |= flagTranslucentNavigation;</span><br><span class="line">            window.setAttributes(attributes);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/1929170-58345fb239443476.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="可以正常设置导航栏颜色"></p>
<h1 id="验证其他使用场景"><a href="#验证其他使用场景" class="headerlink" title="验证其他使用场景"></a>验证其他使用场景</h1><h2 id="侧滑菜单"><a href="#侧滑菜单" class="headerlink" title="侧滑菜单"></a>侧滑菜单</h2><p>使用 AS 自动创建 <code>Navigation Drawer Activity</code> ，布局结构为：</p>
<ul>
<li>DrawerLayout<ul>
<li>include  ：内容布局，默认使用 ToolBar</li>
<li>NavigationView  ：侧滑布局</li>
</ul>
</li>
</ul>
<p>这里只调用了 <code>fullScreen()</code>， 测试一下运行结果如何：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1929170-34df51c894b9dcd6.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="侧滑菜单"></p>
<p>可以看到都有不尽如人意的地方，4.4 系统中内容视图是可以正常延伸到状态栏中，但侧滑菜单中却在上方出现了白条，而在 6.0 中侧滑菜单上会有半透明遮罩。针对 6.0 侧滑菜单半透明遮罩问题，通过设置为 <code>NavigationView</code> 设置属性 <code>app:insetForeground=&quot;#00000000&quot;</code> 即可解决。针对 4.4 侧滑菜单白条问题，经过测试，通过对最外层布局设置 <code>setFitsSystemWindows(true)</code> 和 <code>setClipToPadding(false)</code> 可以解决，所以这里对之前的 <code>fitsSystemWindows</code> 方法稍加修改：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"> /**</span><br><span class="line"> * 设置页面最外层布局 FitsSystemWindows 属性</span><br><span class="line"> *</span><br><span class="line"> * @param activity</span><br><span class="line"> */</span><br><span class="line">private void fitsSystemWindows(Activity activity) &#123;</span><br><span class="line">    ViewGroup contentFrameLayout = (ViewGroup) activity.findViewById(android.R.id.content);</span><br><span class="line">    View parentView = contentFrameLayout.getChildAt(0);</span><br><span class="line">    if (parentView != null &amp;&amp; Build.VERSION.SDK_INT &gt;= 14) &#123;</span><br><span class="line">        //布局预留状态栏高度的 padding</span><br><span class="line">        parentView.setFitsSystemWindows(true);</span><br><span class="line">        if (parentView instanceof DrawerLayout) &#123;</span><br><span class="line">            DrawerLayout drawer = (DrawerLayout) parentView;</span><br><span class="line">            //将主页面顶部延伸至status bar;虽默认为false,但经测试,DrawerLayout需显示设置</span><br><span class="line">            drawer.setClipToPadding(false);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样是解决了上述的问题，既然延伸内容没问题了，那就开开心心地像上面一样调用 <code>addStatusViewWithColor()</code> 方法增加个占位状态栏，解决一下内容顶到头的问题吧：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1929170-16d1ccdfa6a2ba3f.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="4.4 系统，增加占位状态栏异常"></p>
<p>可以看到，效果依然不是我们想要的，虽然占位状态栏是有了，但是却也覆盖到了侧滑菜单上，并且即使设置了 <code>android:fitsSystemWindows=&quot;true&quot;</code> 也并没有什么卵用，内容布局依然顶到了头部。这里有两种解决方法：1. 第一种方案是网上提到比较多的，改变 <code>ToolBar</code> 的高度，并增加状态栏高度的 <code>paddingTop</code>，这也是<br> <a href="https://github.com/gyf-dev/ImmersionBar" target="_blank" rel="noopener">ImmersionBar</a> 库采用的方案。2. 第二种方案其实思路与第一种差不多，就是将原有的内容布局从 <code>DrawerLayout</code> 中移除，并添加到线性布局（布局中已有占位状态栏），之后再将这个线性布局添加到 <code>DrawerLayout</code> 中成为新的内容布局，此谓狸猫换太子。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 是否是最外层布局为 DrawerLayout 的侧滑菜单</span><br><span class="line"> * @param drawerLayout 是否最外层布局为 DrawerLayout</span><br><span class="line"> * @param contentId 内容视图的 id</span><br><span class="line"> * @return</span><br><span class="line"> */</span><br><span class="line">public StatusBarUtils setIsDrawerLayout(boolean drawerLayout, int contentId) &#123;</span><br><span class="line">    mIsDrawerLayout = drawerLayout;</span><br><span class="line">    mContentResourseIdInDrawer = contentId;</span><br><span class="line">    return this;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 添加状态栏占位视图</span><br><span class="line"> *</span><br><span class="line"> * @param activity</span><br><span class="line"> */</span><br><span class="line">private void addStatusViewWithColor(Activity activity, int color) &#123;</span><br><span class="line">    if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.KITKAT) &#123;</span><br><span class="line">        if (isDrawerLayout()) &#123;</span><br><span class="line">            //要在内容布局增加状态栏，否则会盖在侧滑菜单上</span><br><span class="line">            ViewGroup rootView = (ViewGroup) activity.findViewById(android.R.id.content);</span><br><span class="line">            //DrawerLayout 则需要在第一个子视图即内容试图中添加padding</span><br><span class="line">            View parentView = rootView.getChildAt(0);</span><br><span class="line">            LinearLayout linearLayout = new LinearLayout(activity);</span><br><span class="line">            linearLayout.setOrientation(LinearLayout.VERTICAL);</span><br><span class="line">            View statusBarView = new View(activity);</span><br><span class="line">            ViewGroup.LayoutParams lp = new ViewGroup.LayoutParams(ViewGroup.LayoutParams.MATCH_PARENT,</span><br><span class="line">                    getStatusBarHeight(activity));</span><br><span class="line">            statusBarView.setBackgroundColor(color);</span><br><span class="line">            //添加占位状态栏到线性布局中</span><br><span class="line">            linearLayout.addView(statusBarView, lp);</span><br><span class="line">            //侧滑菜单</span><br><span class="line">            DrawerLayout drawer = (DrawerLayout) parentView;</span><br><span class="line">            //内容视图</span><br><span class="line">            View content = activity.findViewById(mContentResourseIdInDrawer);</span><br><span class="line">            //将内容视图从 DrawerLayout 中移除</span><br><span class="line">            drawer.removeView(content);</span><br><span class="line">            //添加内容视图</span><br><span class="line">            linearLayout.addView(content, content.getLayoutParams());</span><br><span class="line">            //将带有占位状态栏的新的内容视图设置给 DrawerLayout</span><br><span class="line">            drawer.addView(linearLayout, 0);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            //设置 paddingTop</span><br><span class="line">            ViewGroup rootView = (ViewGroup) mActivity.getWindow().getDecorView().findViewById(android.R.id.content);</span><br><span class="line">            rootView.setPadding(0, getStatusBarHeight(mActivity), 0, 0);</span><br><span class="line">            if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP) &#123;</span><br><span class="line">                //直接设置状态栏颜色</span><br><span class="line">                activity.getWindow().setStatusBarColor(color);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                //增加占位状态栏</span><br><span class="line">                ViewGroup decorView = (ViewGroup) mActivity.getWindow().getDecorView();</span><br><span class="line">                View statusBarView = new View(activity);</span><br><span class="line">                ViewGroup.LayoutParams lp = new ViewGroup.LayoutParams(ViewGroup.LayoutParams.MATCH_PARENT,</span><br><span class="line">                        getStatusBarHeight(activity));</span><br><span class="line">                statusBarView.setBackgroundColor(color);</span><br><span class="line">                decorView.addView(statusBarView, lp);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>一番操作后，效果如下：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1929170-fe91c2788698c4ab.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="改进 addStatusViewWithColor() 后的效果"></p>
<p>对于内容视图未使用到 <code>ToolBar</code> 的情况方案二依然可以适用。</p>
<h2 id="ActionBar"><a href="#ActionBar" class="headerlink" title="ActionBar"></a>ActionBar</h2><p>上述代码在使用 ActionBar 时可以完美适配吗？测试后效果如下图所示</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1929170-6d63da87454965c6.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="6.0 状态栏黑边"></p>
<p>可以看到，通过添加指定颜色的占位状态来达到沉浸效果的方案，在 4.4 系统上效果是正常的，但是在 6.0 上，在状态栏和 Actionbar 之间会有阴影，这个阴影是主题的效果。不知道大家还记不记得 Theme 主题里的几个设计颜色的属性：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1929170-4730752cae8d63da.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="各属性颜色"></p>
<p><code>colorPrimary</code> 指定 ActionBar 的颜色，<code>colorPrimaryDark</code> 指定状态栏颜色，经过测试，在主题里将二者设为统一颜色，状态栏和 ActionBar 之间不会有黑边。自然，我们除了在 Theme 主题里设置，还可以直接在代码里通过上文提到过的代码修改 5.x 以上系统的状态栏颜色：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Window window = activity.getWindow();</span><br><span class="line">window.addFlags(WindowManager.LayoutParams.FLAG_DRAWS_SYSTEM_BAR_BACKGROUNDS);</span><br><span class="line">window.setStatusBarColor(Color.BLUE);</span><br></pre></td></tr></table></figure>
<p>但是因为 <code>setStatusBarColor()</code> 方法的参数无法传入 Drawble ，所以这种方式是无法实现渐变色状态栏的效果的。所以还是应该聚焦在怎么解决 ActionBar 阴影的问题，上面说了，既然这个阴影是 Theme 的效果，那就肯定有移除这种效果的方法，一种解决方法是更改主题为 ActionBar 不带阴影的主题样式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;style name=&quot;AppTheme&quot; parent=&quot;Theme.AppCompat.Light.DarkActionBar&quot;&gt;</span><br><span class="line">    &lt;!-- Customize your theme here. --&gt;</span><br><span class="line">    &lt;item name=&quot;colorPrimary&quot;&gt;@color/colorPrimary&lt;/item&gt;</span><br><span class="line">    &lt;item name=&quot;colorPrimaryDark&quot;&gt;@color/colorPrimaryDark&lt;/item&gt;</span><br><span class="line">    &lt;item name=&quot;colorAccent&quot;&gt;@color/colorAccent&lt;/item&gt;</span><br><span class="line">    &lt;item name=&quot;android:windowContentOverlay&quot;&gt;@null&lt;/item&gt;</span><br><span class="line">    //更改 ActionBar 风格样式</span><br><span class="line">    &lt;item name=&quot;actionBarStyle&quot;&gt;@style/ActionBarStyleWithoutShadow&lt;/item&gt;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br><span class="line">//ActionBar 不带阴影的主题样式</span><br><span class="line">&lt;style name=&quot;ActionBarStyleWithoutShadow&quot; parent=&quot;android:Theme.Holo.ActionBar&quot;&gt;</span><br><span class="line">    &lt;item name=&quot;background&quot;&gt;@color/blue&lt;/item&gt;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<p>还有第二种更简单的方式，那就是直接在代码里设置去除阴影：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 去除 ActionBar 阴影</span><br><span class="line"> */</span><br><span class="line">public StatusBarUtils clearActionBarShadow() &#123;</span><br><span class="line">    if (Build.VERSION.SDK_INT &gt;= 21) &#123;</span><br><span class="line">        ActionBar supportActionBar = ((AppCompatActivity) mActivity).getSupportActionBar();</span><br><span class="line">        if (supportActionBar != null) &#123;</span><br><span class="line">            supportActionBar.setElevation(0);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return this;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>并且因为内容是位于 ActionBar 之下的，我们还必须给内容视图是指一个 paddingTop，高度为状态栏高度+ActionBar 高度，才可以使内容正常显示。我们给 ActionBar 设置一个渐变色试试看：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">//drawble 文件夹内新建 shape 渐变色</span><br><span class="line">&lt;shape xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    android:shape=&quot;rectangle&quot;&gt;</span><br><span class="line">    &lt;gradient</span><br><span class="line">        android:angle=&quot;0&quot;</span><br><span class="line">        android:centerX=&quot;0.7&quot;</span><br><span class="line">        android:endColor=&quot;@color/shape2&quot;</span><br><span class="line">        android:startColor=&quot;@color/shape1&quot;</span><br><span class="line">        android:centerColor=&quot;@color/shape3&quot;</span><br><span class="line">        android:type=&quot;linear&quot; /&gt;</span><br><span class="line">&lt;/shape&gt;</span><br><span class="line"></span><br><span class="line">//ActionBar 设置渐变背景色</span><br><span class="line">getSupportActionBar().setBackgroundDrawable(getResources().getDrawable(R.drawable.shape));</span><br><span class="line"></span><br><span class="line">//占位状态栏 设置渐变背景色</span><br><span class="line">View statusBarView = new View(activity);</span><br><span class="line">...</span><br><span class="line">//增加占位状态栏方法同上，只是在设置 statusBarView 背景上有 color 和 drawble 之分</span><br><span class="line">statusBarView.setBackground(drawable);</span><br><span class="line"></span><br><span class="line">if (isActionBar()) &#123;</span><br><span class="line">    //要增加内容视图的 paddingTop,否则内容被 ActionBar 遮盖</span><br><span class="line">    if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.KITKAT) &#123;</span><br><span class="line">        ViewGroup rootView = (ViewGroup) mActivity.getWindow().getDecorView().findViewById(android.R.id.content);</span><br><span class="line">        rootView.setPadding(0, getStatusBarHeight(mActivity) + getActionBarHeight(mActivity), 0, 0);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/1929170-6035298aaa147e24.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="渐变色状态栏"></p>
<p>至此，尝试适配了几种比较常见的使用场景的沉浸式状态栏，效果也都还比较符合预期。真正去处理这个问题时会发现其实问题也没有想象中的那么复杂。最后附上 <a href="https://github.com/yazhi1992/Practice" target="_blank" rel="noopener">Github 源码</a>。</p>
<blockquote>
<p>Stay hungry. Stay foolish.</p>
</blockquote>
<p>下篇博客再见。</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Android/" rel="tag"># Android</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/08/03/JIRA-知多少：聊一聊-Android-Studio-、工作流相关设置/" rel="next" title="JIRA 知多少：聊一聊 Android Studio 、工作流相关设置">
                <i class="fa fa-chevron-left"></i> JIRA 知多少：聊一聊 Android Studio 、工作流相关设置
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/10/29/Jenkins-持续集成实现-Android-自动化打包/" rel="prev" title="Jenkins 持续集成实现 Android 自动化打包">
                Jenkins 持续集成实现 Android 自动化打包 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
    </div>
  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/link.png" alt="Taki">
            
              <p class="site-author-name" itemprop="name">Taki</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">47</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">19</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/yazhidev" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#沉浸式状态栏的实现"><span class="nav-number">1.</span> <span class="nav-text">沉浸式状态栏的实现</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#方法一：通过设置-Theme-主题设置状态栏透明"><span class="nav-number">1.1.</span> <span class="nav-text">方法一：通过设置 Theme 主题设置状态栏透明</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#法一：设置-fitsSystemWindows-属性"><span class="nav-number">1.1.1.</span> <span class="nav-text">法一：设置 fitsSystemWindows 属性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#法二：布局里添加占位状态栏"><span class="nav-number">1.1.2.</span> <span class="nav-text">法二：布局里添加占位状态栏</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#法三：代码中设置-paddingTop-并添加占位状态栏"><span class="nav-number">1.1.3.</span> <span class="nav-text">法三：代码中设置 paddingTop 并添加占位状态栏</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#方法二：代码中设置"><span class="nav-number">1.2.</span> <span class="nav-text">方法二：代码中设置</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#方案二：全屏模式的延伸"><span class="nav-number">2.</span> <span class="nav-text">方案二：全屏模式的延伸</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#验证其他使用场景"><span class="nav-number">3.</span> <span class="nav-text">验证其他使用场景</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#侧滑菜单"><span class="nav-number">3.1.</span> <span class="nav-text">侧滑菜单</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ActionBar"><span class="nav-number">3.2.</span> <span class="nav-text">ActionBar</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Taki</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
